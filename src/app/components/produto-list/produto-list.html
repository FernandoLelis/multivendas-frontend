<div class="produto-list">
  <div class="header-actions">
    <h2>Produtos</h2>
    <button class="btn-novo-produto" (click)="abrirModal()">
      Novo Produto
    </button>
  </div>

  <div class="carregando" *ngIf="produtos.length === 0">
      <div class="spinner"></div>
  </div>

  <div class="produtos-grid">
    <div class="produto-card" *ngFor="let produto of produtos">
      
      <div class="produto-grid-container">
        
        <div class="col-imagem">
          <div class="img-placeholder">
            <span class="icon-img">üì∑</span>
            <span class="text-img">Sem Imagem</span>
          </div>
        </div>

        <div class="col-identificacao">
          <h3>{{ produto.nome }}</h3>
          <div class="tags-identificacao">
            <span class="tag">SKU: {{ produto.sku }}</span>
            <span class="tag" *ngIf="produto.asin">ASIN: {{ produto.asin }}</span>
          </div>
          <p class="desc-truncada" *ngIf="produto.descricao">{{ produto.descricao }}</p>
          <span class="data-criacao">Adicionado em: {{ formatarData(produto.dataCriacao) }}</span>
          
          <a class="link-expandir" (click)="toggleMedidas(produto.id!)">
            {{ medidasExpandidas.has(produto.id!) ? 'Ocultar' : 'Ver' }} Pesos e Medidas 
            <span class="seta">{{ medidasExpandidas.has(produto.id!) ? '‚ñ≤' : '‚ñº' }}</span>
          </a>
        </div>

        <div class="col-estoque">
          <div class="info-bloco destaque">
            <span class="info-label">Estoque Atual</span>
            <span class="info-valor" [class.alerta-vermelho]="isEstoqueBaixo(produto)">
              {{ produto.quantidadeEstoqueTotal || 0 }} un.
            </span>
          </div>
          <div class="info-bloco">
            <span class="info-label">Estoque M√≠nimo</span>
            <span class="info-valor secundario">{{ produto.estoqueMinimo || 0 }} un.</span>
          </div>
        </div>

        <div class="col-financeiro">
          <div class="financeiro-linha">
            <span class="fin-label">Qtd Vendida:</span>
            <span class="fin-valor">{{ produto.quantidadeVendida || 0 }}</span>
          </div>
          <div class="financeiro-linha">
            <span class="fin-label">Custo M√©d.:</span>
            <span class="fin-valor">{{ formatarMoeda(produto.custoMedio) }}</span>
          </div>
          <div class="financeiro-linha">
            <span class="fin-label">Pre√ßo M√©d.:</span>
            <span class="fin-valor">{{ formatarMoeda(produto.precoMedioVenda) }}</span>
          </div>
          <div class="financeiro-linha">
            <span class="fin-label">Lucro/un:</span>
            <span class="fin-valor" 
                  [ngClass]="{
                    'lucro-positivo': calcularLucroMedio(produto) > 0, 
                    'lucro-negativo': calcularLucroMedio(produto) < 0
                  }">
              {{ formatarMoeda(calcularLucroMedio(produto)) }}
            </span>
          </div>
        </div>

        <div class="col-acoes">
          <button class="btn-editar" (click)="editarProduto(produto)">Editar</button>
          <button class="btn-excluir" (click)="excluirProduto(produto)">Excluir</button>
        </div>

      </div>

      <div class="area-medidas-expandida" *ngIf="medidasExpandidas.has(produto.id!)">
        <div class="medidas-container">
          <div class="medida-item">
            <span class="medida-label">Peso:</span>
            <span class="medida-valor placeholder">-- kg</span>
          </div>
          <div class="medida-item">
            <span class="medida-label">Comprimento:</span>
            <span class="medida-valor placeholder">-- cm</span>
          </div>
          <div class="medida-item">
            <span class="medida-label">Largura:</span>
            <span class="medida-valor placeholder">-- cm</span>
          </div>
          <div class="medida-item">
            <span class="medida-label">Altura:</span>
            <span class="medida-valor placeholder">-- cm</span>
          </div>
        </div>
        <div class="medidas-aviso">
          <em>* Estes campos ser√£o implementados na edi√ß√£o em breve para c√°lculo de frete.</em>
        </div>
      </div>

    </div>   
  </div>

  <app-produto-form   
    *ngIf="mostrarModal"
    [produto]="produtoParaEditar"
    (fecharModal)="fecharModal()"
    (produtoSalvo)="onProdutoSalvo()">
  </app-produto-form>
</div>