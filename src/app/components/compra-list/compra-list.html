<div class="compra-list">
  <div class="header-actions">
    <h2>Compras</h2>
    <button class="btn-nova-compra" (click)="novaCompra()">Nova Compra</button>
  </div>

  <div class="compras-grid">
    <!-- CARDS DINÂMICOS -->
    <div class="compra-card" *ngFor="let compra of compras">
      
      <!-- HEADER SIMPLIFICADO -->
      <div class="compra-header">
        <div class="header-info">
          <h3>Compra #{{ compra.idPedidoCompra }}</h3>
          <div class="header-subtitle">
            <span class="fornecedor">{{ compra.fornecedor || 'Fornecedor não informado' }}</span>
            <span class="separator">•</span>
            <span class="data">{{ getDataCompra(compra) }}</span>
          </div>
        </div>
      </div>
      
      <!-- CONTEÚDO PRINCIPAL -->
      <div class="compra-content">
        <div class="compra-info">
          <!-- INFORMAÇÕES ESSENCIAIS -->
          <div class="info-row">
            <span class="label">Quantidade Total:</span>
            <span class="value">{{ getQuantidadeTotal(compra) }} unidades</span>
          </div>
          
          <div class="info-row">
            <span class="label">Produtos:</span>
            <span class="value">{{ getNumeroProdutos(compra) }} itens</span>
          </div>
          
          <div class="info-row">
            <span class="label">Custo Total:</span>
            <span class="value highlight">{{ compra.custoTotal | brlCurrency }}</span>
          </div>
          
          <!-- OBSERVAÇÕES (se existir) -->
          <div class="info-row" *ngIf="compra.observacoes">
            <span class="label">Observações:</span>
            <span class="value observacoes">{{ compra.observacoes }}</span>
          </div>
        </div>
      </div>

      
      <!-- LISTA DE PRODUTOS -->
      <div class="produtos-resumo" *ngIf="compra.itens && compra.itens.length > 0">
        <div class="produtos-header" (click)="toggleProdutos(compra)">
          <span class="toggle-icon">{{ getMostrarProdutos(compra) ? '▼' : '▶' }}</span>
          <span class="produtos-label">
            Detalhes dos Produtos ({{ compra.itens.length }})
          </span>
        </div>
        
        <div class="produtos-lista" *ngIf="getMostrarProdutos(compra)">
          <div *ngFor="let item of compra.itens" class="produto-item">
            <div class="produto-info">
              <span class="produto-nome">{{ item.produtoNome || 'Produto não identificado' }}</span>
              <span class="produto-sku" *ngIf="item.produtoSku">({{ item.produtoSku }})</span>
            </div>
            <div class="produto-detalhes">
              <span class="produto-quantidade">{{ item.quantidade }} unidades</span>
              <span class="separator">•</span>
              <span class="produto-custo">{{ item.custoUnitario | brlCurrency }} /un</span>
              <span class="separator">•</span>
              <span class="produto-subtotal">
                Subtotal: {{ (item.quantidade * item.custoUnitario) | brlCurrency }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- BOTÕES DE AÇÃO -->
      <div class="compra-actions">
        <button class="btn-editar" (click)="editarCompra(compra)">Editar</button>
        <button class="btn-excluir" (click)="excluirCompra(compra)">Excluir</button>
      </div>
    </div>

    <!-- MENSAGEM QUANDO NÃO HÁ COMPRAS -->
    <div class="sem-compras" *ngIf="compras.length === 0">
        Nenhuma compra cadastrada
    </div>
  </div>

  <!-- MODAL DE COMPRA -->
  <app-compra-form 
    *ngIf="mostrarModal"
    [compra]="compraEditando"
    (fecharModal)="fecharModal()"
    (compraSalva)="onCompraSalva()">
  </app-compra-form>
</div>