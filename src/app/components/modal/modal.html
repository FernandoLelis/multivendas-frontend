@if (config) {
<div class="modal-overlay" (click)="fechar()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 [class]="getClasseTitulo()">{{ config.titulo }}</h2>
      <button class="btn-fechar" (click)="fechar()">√ó</button>
    </div>
    
    <div class="modal-body">
      @if (getClasseIcone() && config.template !== 'detalhes-venda' && config.template !== 'alerta-peps' && config.template !== 'alerta-peps-exclusao' && config.template !== 'alerta-produto-exclusao' && config.template !== 'erro-id-duplicado') {
        <div [class]="getClasseIcone()">
          {{ getIcone() }}
        </div>
      }
      
      <!-- TEMPLATE PARA DETALHES DE VENDA -->
      @if (config.template === 'detalhes-venda') {
        <div class="detalhes-venda">
          <div class="categoria">üìã INFORMA√á√ïES B√ÅSICAS</div>
          <div class="item">
            <span class="label">Pedido:</span>
            <span class="value destaque">{{ config.dadosEspecificos?.informacoesBasicas?.pedido }}</span>
          </div>
          <div class="item">
            <span class="label">Plataforma:</span>
            <span class="value">{{ config.dadosEspecificos?.informacoesBasicas?.plataforma }}</span>
          </div>
          <div class="item">
            <span class="label">Data:</span>
            <span class="value">{{ config.dadosEspecificos?.informacoesBasicas?.data }}</span>
          </div>
          <div class="item">
            <span class="label">Produto:</span>
            <span class="value destaque">{{ config.dadosEspecificos?.informacoesBasicas?.produto }}</span>
          </div>
          <div class="item">
            <span class="label">Quantidade:</span>
            <span class="value">{{ config.dadosEspecificos?.informacoesBasicas?.quantidade }}</span>
          </div>

          <div class="divisor"></div>

          <div class="categoria">üí∞ VALORES FINANCEIROS</div>
          <div class="item">
            <span class="label">Pre√ßo de Venda:</span>
            <span class="value">{{ config.dadosEspecificos?.valoresFinanceiros?.precoVenda | brlCurrency }}</span>
          </div>
          <div class="item">
            <span class="label">Frete Pago:</span>
            <span class="value">{{ config.dadosEspecificos?.valoresFinanceiros?.fretePago | brlCurrency }}</span>
          </div>
          <div class="item">
            <span class="label">Custo do Envio:</span>
            <span class="value">{{ config.dadosEspecificos?.valoresFinanceiros?.custoEnvio | brlCurrency }}</span>
          </div>
          <div class="item">
            <span class="label">Tarifa da Plataforma:</span>
            <span class="value">{{ config.dadosEspecificos?.valoresFinanceiros?.tarifa | brlCurrency }}</span>
          </div>

          <div class="divisor"></div>

          <div class="categoria">üìä C√ÅLCULOS AUTOM√ÅTICOS</div>
          <div class="item">
            <span class="label">Custo do Produto:</span>
            <span class="value">{{ config.dadosEspecificos?.calculos?.custoProduto | brlCurrency }}</span>
          </div>
          <div class="item">
            <span class="label">Custo Efetivo Total:</span>
            <span class="value">{{ config.dadosEspecificos?.calculos?.custoEfetivoTotal | brlCurrency }}</span>
          </div>
          <div class="item">
            <span class="label">Lucro L√≠quido:</span>
            <span class="value" [class.positivo]="config.dadosEspecificos?.calculos?.lucroPositivo" 
                   [class.negativo]="!config.dadosEspecificos?.calculos?.lucroPositivo">
              {{ config.dadosEspecificos?.calculos?.lucroLiquido | brlCurrency }}
            </span>
          </div>
          <div class="item">
            <span class="label">ROI:</span>
            <span class="value" [class.positivo]="config.dadosEspecificos?.calculos?.roiPositivo" 
                   [class.negativo]="!config.dadosEspecificos?.calculos?.roiPositivo">
              {{ formatarROI(config.dadosEspecificos?.calculos?.roi) }}
            </span>
          </div>
        </div>
      }

      <!-- TEMPLATE PARA ALERTA PEPS EDI√á√ÉO -->
      @if (config.template === 'alerta-peps') {
        <div class="alerta-peps">
          <div class="texto-principal">Esta compra n√£o pode ser alterada porque parte do lote j√° foi vendido</div>
          
          <div class="secao">
            <div class="titulo-secao">Detalhes do Lote:</div>
            <div class="texto-detalhes">Saldo atual: {{ config.dadosEspecificos?.saldoAtual }} unidades</div>
            <div class="texto-detalhes">Quantidade original: {{ config.dadosEspecificos?.quantidadeAntiga }} unidades</div>
          </div>

          <div class="secao">
            <div class="titulo-secao">Como funciona o sistema?</div>
            <div class="texto-detalhes">Para manter o rastreamento preciso de custos, lotes j√° utilizados em vendas n√£o podem ser alterados.</div>
          </div>

          <div class="secao">
            <div class="titulo-secao">Solu√ß√£o sugerida:</div>
            <div class="texto-detalhes">Exclua as VENDAS que utilizaram este lote para liberar a edi√ß√£o.</div>
          </div>
        </div>
      }

      <!-- TEMPLATE PARA ALERTA PEPS EXCLUS√ÉO -->
      @if (config.template === 'alerta-peps-exclusao') {
        <div class="alerta-peps">
          <div class="texto-principal">Esta compra n√£o pode ser exclu√≠da porque parte do lote j√° foi vendido</div>
          
          <div class="secao">
            <div class="titulo-secao">Detalhes do Lote:</div>
            <div class="texto-detalhes">Saldo atual: {{ config.dadosEspecificos?.saldoAtual }} unidades</div>
            <div class="texto-detalhes">Quantidade original: {{ config.dadosEspecificos?.quantidadeAntiga }} unidades</div>
          </div>

          <div class="secao">
            <div class="titulo-secao">Como funciona o sistema?</div>
            <div class="texto-detalhes">Para manter o rastreamento preciso de custos, lotes j√° utilizados em vendas n√£o podem ser exclu√≠dos.</div>
          </div>

          <div class="secao">
            <div class="titulo-secao">Solu√ß√£o sugerida:</div>
            <div class="texto-detalhes">Exclua as VENDAS que utilizaram este lote primeiro para liberar a exclus√£o.</div>
          </div>
        </div>
      }

      <!-- ‚úÖ NOVO TEMPLATE PARA ALERTA EXCLUS√ÉO PRODUTO -->
      @if (config.template === 'alerta-produto-exclusao') {
        <div class="alerta-peps">
          <div class="texto-principal">Este produto n√£o pode ser exclu√≠do porque possui vendas associadas</div>
          
          <div class="secao">
            <div class="titulo-secao">Como funciona o sistema?</div>
            <div class="texto-detalhes">Para manter o rastreamento preciso de custos e hist√≥rico financeiro, produtos com vendas registradas n√£o podem ser exclu√≠dos.</div>
          </div>

          <div class="secao">
            <div class="titulo-secao">Solu√ß√£o sugerida:</div>
            <div class="texto-detalhes">Exclua as VENDAS associadas a este produto primeiro para liberar a exclus√£o.</div>
          </div>
        </div>
      }

      <!-- ‚úÖ NOVO TEMPLATE PARA ERRO ID DUPLICADO -->
      @if (config.template === 'erro-id-duplicado') {
        <div class="alerta-peps">
          <div class="texto-principal">
            O ID do pedido <strong>"{{ config.dadosEspecificos?.idPedido }}"</strong> j√° est√° em uso no seu sistema.
          </div>
          
          <div class="secao">
            <div class="titulo-secao">üí° Por que isso acontece?</div>
            <div class="texto-detalhes">Cada ID de pedido deve ser √∫nico para manter o rastreamento correto das suas compras.</div>
          </div>

          <div class="secao">
            <div class="titulo-secao">üîÑ Sugest√µes para resolver:</div>
            <div class="texto-detalhes">‚Ä¢ Use um ID diferente para esta compra</div>
            <div class="texto-detalhes">‚Ä¢ Verifique suas compras anteriores</div>
            <div class="texto-detalhes">‚Ä¢ Adicione um sufixo como "-1", "-2", etc.</div>
            <div class="texto-detalhes">‚Ä¢ Exemplo: <strong>{{ config.dadosEspecificos?.idPedido }}-1</strong></div>
          </div>
        </div>
      }

      <!-- MENSAGEM PADR√ÉO (para modais simples) -->
      @if (!config.template) {
        <div class="mensagem">{{ config.mensagem }}</div>
      }
    </div>

    <div class="modal-actions">
      @if (config.textoBotaoSecundario) {
        <button class="btn-secundario"
                (click)="cancelar()">
          {{ config.textoBotaoSecundario }}
        </button>
      }
      <button class="btn-primario" 
              [class]="getClasseBotaoPrimario()"
              (click)="confirmar()">
        {{ config.textoBotaoPrimario || 'OK' }}
      </button>
    </div>
  </div>
</div>
}