<div class="venda-list">
  <div class="header-actions">
    <h2>Vendas</h2>
    <button class="btn-nova-venda" (click)="novaVenda()">Nova Venda</button>
  </div>

   <!-- INDICADOR DE CARREGAMENTO -->
  <!-- <div class="carregando" *ngIf="carregando">
    <div class="spinner"></div>
  </div> -->

  <div class="vendas-grid">
    <div *ngFor="let venda of vendas" class="venda-card">
      
      <div class="venda-header">
        <h3>{{ getResumoProdutos(venda) }}</h3>
        <span class="plataforma-tag" [ngClass]="getPlataformaClass(venda.plataforma)">
          {{ venda.plataforma }}
        </span>
      </div>
      
      <div class="venda-content">
        <div class="venda-info">
          <div class="info-row">
            <span class="label">ID do Pedido:</span>
            <span class="value">{{ venda.idPedido }}</span>
          </div>
          <div class="info-row">
            <span class="label">Data:</span>
            <span class="value">{{ venda.data | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Valor Total:</span>
            <span class="value highlight">{{ venda.precoVenda | brlCurrency }}</span>
          </div>
          <div class="info-row">
            <span class="label">Custo Efetivo:</span>
            <span class="value">{{ venda.custoEfetivoTotal | brlCurrency }}</span>
          </div>
          <div class="info-row">
            <span class="label">Lucro Líquido:</span>
            <span class="value lucro-liquido" 
                  [class.positive]="venda.lucroLiquido > 0"
                  [class.negative]="venda.lucroLiquido < 0">
              {{ venda.lucroLiquido | brlCurrency }}
            </span>
          </div>
          <div class="info-row">
            <span class="label">ROI:</span>
            <span class="value roi" 
                  [class.positive]="venda.roi > 0"
                  [class.negative]="venda.roi < 0">
              {{ formatarROI(venda.roi) }}
            </span>
          </div>
        </div>

        <div class="produtos-resumo">
          <div class="produtos-header" (click)="toggleProdutos(venda)">
            <span class="toggle-icon">{{ venda.mostrarProdutos ? '▼' : '▶' }}</span>
            <span class="produtos-label">
              {{ venda.mostrarProdutos ? 'Ocultar detalhes' : 'Ver produtos' }} ({{ getNumeroProdutos(venda) }})
            </span>
          </div>
          
          <div class="produtos-lista" *ngIf="venda.mostrarProdutos">
            <div *ngFor="let item of getItensAgrupados(venda)" class="produto-item">
              <span class="produto-nome">{{ item.nome }}</span>
              <span class="produto-quantidade">{{ item.quantidade }}x</span>
              <span class="produto-preco">{{ item.custoMedio | brlCurrency }} (médio)</span>
            </div>
          </div>
        </div>
      </div>

      <div class="venda-actions">
        <button class="btn-detalhes" (click)="detalhesVenda(venda)">Detalhes</button>
        <button class="btn-editar" (click)="editarVenda(venda)">Editar</button>
        <button class="btn-excluir" (click)="excluirVenda(venda)">Excluir</button>
      </div>
    </div>
  </div>
</div>

<app-venda-form 
  *ngIf="mostrarFormVenda" 
  [venda]="vendaSelecionada" 
  (fecharModal)="fecharFormVenda()" 
  (vendaSalva)="carregarVendas()" 
  (abrirCompraParaProduto)="abrirCompraParaProduto($event)">
</app-venda-form>

<app-compra-form 
  *ngIf="mostrarFormCompra" 
  [compra]="produtoParaCompra" 
  (fecharModal)="fecharFormCompra()" 
  (compraSalva)="onCompraSalva()">
</app-compra-form>