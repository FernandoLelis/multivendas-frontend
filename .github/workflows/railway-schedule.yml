name: üöÑ Railway Auto Schedule
on:
  schedule:
    # LIGA √†s 6h da manh√£ (hor√°rio Brasil)
    - cron: '0 9 * * *'  # 9h UTC = 6h Bras√≠lia
    # DESLIGA √†s 23h (hor√°rio Brasil)  
    - cron: '0 2 * * *'  # 2h UTC = 23h Bras√≠lia
  workflow_dispatch:  # Permite executar manualmente

jobs:
  control-railway:
    runs-on: ubuntu-latest
    steps:
      - name: üïí Check current time
        run: echo "Hor√°rio UTC: $(date)"
        
      - name: üîÑ Determine action based on schedule
        id: schedule
        run: |
          if [[ "${{ github.event.schedule }}" == "0 9 * * *" ]]; then
            echo "action=wake" >> $GITHUB_OUTPUT
            echo "üöÄ Acordando Railway - In√≠cio do dia (6h Bras√≠lia)"
          else
            echo "action=sleep" >> $GITHUB_OUTPUT
            echo "üí§ Colocando Railway para dormir - Fim do dia (23h Bras√≠lia)"
          fi
          
      - name: üöÄ Wake Up Railway
        if: steps.schedule.outputs.action == 'wake'
        run: |
          curl -X POST "https://backpack-api.railway.app/graphql/v2" \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
          -d '{
            "query": "mutation { serviceInstanceUpdate(id: \"${{ secrets.RAILWAY_SERVICE_ID }}\", input: { sleep: false }) { id sleep } }"
          }'
          
      - name: üí§ Sleep Railway
        if: steps.schedule.outputs.action == 'sleep'
        run: |
          curl -X POST "https://backpack-api.railway.app/graphql/v2" \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
          -d '{
            "query": "mutation { serviceInstanceUpdate(id: \"${{ secrets.RAILWAY_SERVICE_ID }}\", input: { sleep: true }) { id sleep } }"
          }'
          
      - name: ‚úÖ Verify action
        run: |
          echo "‚úÖ A√ß√£o executada: ${{ steps.schedule.outputs.action }}"
          echo "‚è∞ Hor√°rio UTC: $(date)"
